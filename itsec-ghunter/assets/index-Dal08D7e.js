function k(r,i={}){var c,w,l,y,S,h,z,p,A,T,U,b,x;const u=r.map(t=>{const s=C(t.data);return{...t,data:s,size:(s==null?void 0:s.length)||0}});let o=0;for(let t=0;t<r.length;t++){const s=((c=u[t].data)==null?void 0:c.length)??0;o+=512+512*Math.trunc(s/512),s%512&&(o+=512)}let f=10240*Math.trunc(o/10240);o%10240&&(f+=10240);const n=new ArrayBuffer(f);let e=0;for(const t of u){const s=!t.data;a(n,t.name,e,100);const M=((w=t.attrs)==null?void 0:w.mode)??((l=i.attrs)==null?void 0:l.mode)??(s?"775":"664");a(n,g(M,7),e+100,8);const _=((y=t.attrs)==null?void 0:y.uid)??((S=i.attrs)==null?void 0:S.uid)??1e3;a(n,g(_.toString(8),7),e+108,8);const B=((h=t.attrs)==null?void 0:h.gid)??((z=i.attrs)==null?void 0:z.gid)??1e3;a(n,g(B.toString(8),7),e+116,8),a(n,g(t.size.toString(8),11),e+124,12);const E=((p=t.attrs)==null?void 0:p.mtime)??((A=i.attrs)==null?void 0:A.mtime)??Date.now();a(n,g(Math.trunc(E/1e3).toString(8),11),e+136,12),a(n,s?"5":"0",e+156,1),a(n,"ustar",e+257,6),a(n,"00",e+263,2);const G=((T=t.attrs)==null?void 0:T.user)??((U=i.attrs)==null?void 0:U.user)??"";a(n,G,e+265,32);const I=((b=t.attrs)==null?void 0:b.group)??((x=i.attrs)==null?void 0:x.group)??"";a(n,I,e+297,32),a(n,"        ",e+148,8);const R=new Uint8Array(n,e,512);let D=0;for(let d=0;d<512;d++)D+=R[d];if(a(n,D.toString(8),e+148,8),!s){const d=new Uint8Array(n,e+512,t.size);for(let m=0;m<t.size;m++)d[m]=t.data[m];e+=512*Math.trunc(t.size/512),t.size%512&&(e+=512)}e+=512}return new Uint8Array(n)}function q(r,i={}){const u=k(r,i);return new ReadableStream({start(o){o.enqueue(u),o.close()}}).pipeThrough(new CompressionStream(i.compression??"gzip"))}async function V(r,i={}){return await new Response(q(r,i)).arrayBuffer().then(o=>new Uint8Array(o))}function a(r,i,u,o){const f=new Uint8Array(r,u,o),e=new TextEncoder().encodeInto(i,f).written;for(let c=e;c<o;c++)f[c]=0}function g(r,i){return String(r).padStart(i,"0")}function C(r){if(r!=null)return typeof r=="string"?new TextEncoder().encode(r):r instanceof ArrayBuffer?new Uint8Array(r):r}export{k as createTar,V as createTarGzip,q as createTarGzipStream};
