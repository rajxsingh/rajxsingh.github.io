import{d as D,z as B,r as M,K as H,L as N,E as $,f as d,n as k,g as b,t as E,o as v,p as I}from"../modules/vue-CTWl0XJE.js";import{C as P}from"../index-BLH6RZi2.js";const T=["innerHTML"],K=["textContent"],z=["textContent"],h="slidev-note-fade",r="slidev-note-click-mark",q=D({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(S,{emit:A}){const l=S,g=A,C=B(()=>{var i;return l.clicksContext!=null&&((i=l.noteHtml)==null?void 0:i.includes(r))}),p=M(null);function y(){var x,L;if(!p.value||!C.value)return;const i=Array.from(p.value.querySelectorAll(`.${r}`)),c=new Map,a=new Map;let _=0;for(const s of i){const o=Number(s.dataset.clicks);c.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==p.value;)a.has(e)||a.set(e,[[null,_]]),a.get(e).push([t,o]),t=e,e=e.parentElement;_=o}const w=new Map;for(const[s,o]of a){let t=!1,e=0;for(const n of Array.from(s.childNodes)){let m=!1;for(;n===((x=o[e+1])==null?void 0:x[0]);)m=!0,e++;if(m)continue;let u=n;if(n.nodeType===3){if(!((L=n.textContent)!=null&&L.trim()))continue;u=document.createElement("span"),u.textContent=n.textContent,s.insertBefore(u,n),n.remove()}t||(t=e===0),w.set(u,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=l.highlight;for(const[t,e]of a)t.classList.toggle(h,o&&!e.some(([n,m])=>m===s));for(const[t,e]of w)t.classList.toggle(h,o&&e!==s);for(const[t,e]of c)t.classList.remove(h),t.classList.toggle(`${r}-past`,o&&e<s),t.classList.toggle(`${r}-active`,o&&e===s),t.classList.toggle(`${r}-next`,o&&e===s+1),t.classList.toggle(`${r}-future`,o&&e>s+1),t.ondblclick=n=>{o&&(g("markerDblclick",n,e),!n.defaultPrevented&&(l.clicksContext.current=e,n.stopPropagation(),n.stopImmediatePropagation()))},t.onclick=n=>{o&&g("markerClick",n,e)},o&&l.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const f=M();return H(()=>[l.noteHtml,l.highlight],()=>{I(()=>{f.value=y()})},{immediate:!0}),N(()=>{y()}),$(()=>{var c,a;const i=((c=l.clicksContext)==null?void 0:c.current)??P;(a=f.value)==null||a.call(f,i)}),(i,c)=>i.noteHtml?(v(),d("div",{key:0,ref_key:"noteDisplay",ref:p,class:k(["prose overflow-auto outline-none slidev-note",[l.class,C.value?"slidev-note-with-clicks":""]]),innerHTML:i.noteHtml},null,10,T)):i.note?(v(),d("div",{key:1,class:k(["prose overflow-auto outline-none slidev-note",l.class])},[b("p",{textContent:E(i.note)},null,8,K)],2)):(v(),d("div",{key:2,class:k(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",l.class])},[b("p",{textContent:E(l.placeholder||"No notes.")},null,8,z)],2))}});export{q as _};
